<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>湖南省现代公共文化服务体系旅游厕所管理平台--登录 </title>
	#include("/common/include/include.html")
	
	<!--登录手机验证-->
    <link href="#(ctx)/res/login.css" rel="stylesheet" type="text/css">
    <link href="#(ctx)/res/jquery.alerts.css" rel="stylesheet" type="text/css">
    <link href="#(ctx)/res/jquery-ui.min.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="#(ctx)/res/jquery.alerts.js" charset="utf-8"></script>
	<script type="text/javascript" src="#(ctx)/res/login.js" charset="utf-8"></script>
	<script type="text/javascript" src="#(ctx)/res/jquery-ui.min.js" charset="utf-8"></script>
	<style>
	    body { font-size: 62.5%; }
	    label, input { display:block; }
	    input.text { margin-bottom:12px; width:95%; padding: .4em; }
	    fieldset { padding:0; border:0; margin-top:25px; }
	    div#users-contain { width: 350px; margin: 20px 0; }
	    div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
	    div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
	    .ui-dialog .ui-state-error { padding: .3em; }
	    .validateTips { border: 1px solid transparent; padding: 0.3em; }
	</style>
</head>
<body>
    <div id="container" class="cls-container">
		<!-- BACKGROUND IMAGE -->
		<!--===================================================-->
		<div id="bg-overlay" class="bg-img" style="background-image: url(#(ctx)/common/img/bg-img/bg-img-oa.jpg)"></div>
		
		
		<!-- LOGIN FORM -->
		<!--===================================================-->
		<div class="cls-content">
		    <div class="cls-content-sm panel" style="margin-top:150px;">
		        <div class="panel-body">
		            <div class="mar-ver pad-btm">
		                <h3 class="h4 mar-no">登录</h3>
		                <p class="text-muted">使用您的帐号密码进行登录</p>
		            </div>
		            <form id="editForm" action="#(ctx)/admin/login/login">
		                <div class="form-group">
		                    <input type="text" id="username" name="username" class="form-control" placeholder="请输入您的登录用户名" autofocus>
		                </div>
		                <div class="form-group">
		                    <input type="password" id="password" name="password" class="form-control" placeholder="请输入您的登录密码">
		                </div>
		                <div class="checkbox pad-btm text-left" style="display: none;">
		                    <input type="text" id="captcha" name="captcha" class="form-control" placeholder="验证码" style="float: left;width: 162px;margin-right: 40px;" maxlength="4" value="8888">
		                </div>
		                <!-- 
		                <div class="checkbox pad-btm text-left">
		                    <input id="demo-form-checkbox" class="magic-checkbox" type="checkbox">
		                    <label for="demo-form-checkbox">记住我</label>
		                </div> -->
		                <button class="btn btn-primary btn-lg btn-block" type="button" onclick="login()">手机验证</button>
		            </form>
		        </div>
		        <div class="pad-all">
		        	<a download="2018 湖南省现代公共文化服务体系旅游厕所管理平台-操作手册.rar" href="#(ctx)/upload/document.rar" class="btn-link mar-lft">下载平台操作手册</a>
		        	<a download="360急速浏览器.exe" href="http://down.360safe.com/cse/360cse_9.5.0.138.exe" class="btn-link mar-lft">下载浏览器</a>
		            <!-- <a href="#" class="btn-link mar-rgt">忘记密码 ?</a> -->
		            <!-- <a href="#(ctx??)/admin/login/register" class="btn-link mar-lft">注册新账号</a> -->
		
		            <!-- <div class="media pad-top bord-top">
		                <div class="pull-right">
		                    <a href="#" class="pad-rgt"><i class="ti-facebook icon-lg text-primary"></i></a>
		                    <a href="#" class="pad-rgt"><i class="ti-twitter-alt icon-lg text-info"></i></a>
		                    <a href="#" class="pad-rgt"><i class="ti-google icon-lg text-danger"></i></a>
		                </div>
		                <div class="media-body text-left">
		                    	其他方式登陆
		                </div>
		            </div> -->
		        </div>
		    </div>
		</div>
    </div>
    <div id="dialog-form" title="手机验证">
		<p class="validateTips">所有的字段都是必填的。</p>
		<div id="login">
	    <div class="wrapper">
			<form class="login" id="loginForm" action="#(ctx)/admin/login/loginA">
	            <div class="container offset1 loginform" style="top: 10px;">
	                <div class="pad">
	                    <div class="control-group">
	                        <div class="controls">
	                            <label for="phone" class="control-label fa fa-phone"></label>
	                            <input id="phone1" type="phone" name="phone1" placeholder="请输入您需要绑定的手机号码" tabindex="3" class="form-control input-medium" maxlength="11">
		                		<input type="hidden" id="phone" name="phone">
	                        </div>
	                    </div>
	                    <div class="control-group">
	                        <div class="controls" style="float: left;width: 200px;">
	                            <label for="userchk" class="control-label fa fa-barcode"></label>
	                            <input id="userchk" type="userchk" name="captcha" placeholder="请输入图片验证码" tabindex="4" class="form-control input-medium" maxlength="4">
	                        </div>
	                        <div class="controls" style="float: left;width: 138px;">
	                            <div class="chkimg"><img src="#(ctx)/admin/login/img" width="80" height="40" border="0" id="vcode"><a href="javascript:void(0);" onclick="refreshCode('#(ctx)')">换一张？</a></div>
	                        </div>
	                    </div>
	                    <div class="control-group">
	                        <div class="controls" style="float: left;width: 200px;">
	                            <label for="smscode" class="control-label fa fa-code"></label>
	                            <input id="smscode" type="smscode" name="smscode" placeholder="请输入短信动态码" tabindex="5" class="form-control input-medium" maxlength="6">
	                         </div>
	                        <div class="controls" style="float: left;width: 138px;">
	                            <div class="btn-box"><input type="button" name="btn_smscode" id="btn_smscode" value="获取动态码" class="btn_smscode" onclick="sendSmscode('#(ctx)')" /><span class="btn_smscode_gray" style="display:none;" id="clocker">60秒</span></div>
	                        </div>
	                    </div>
		                <input type="hidden" id="phone" name="username">
		                <input type="hidden" id="code" name="password">
	                </div>
	            </div>
	        </form>
		</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var path = "#(ctx)";
	function subcheck(){
		var username = $("#editForm").find("input[name='username']").val();
		var password = $("#editForm").find("input[name='password']").val();
		if(username == ""){
			jAlert("登录账户不能为空","提示");
			return false;
		}
		if(password == ""){
			jAlert("登录密码不能为空","提示");
			return false;
		}
		return true;
	}
	function login(){
		if(subcheck()){
			var data = common_ajax.ajaxFunc("/admin/login/login", $('#editForm').serialize(), "json", null);
			if(data.success){
				var mobile = data.message;
				if(mobile==null || mobile==""){
					jAlert("未绑定手机号码，需要先进行手机短信验证！","提示",function(){
						$("#dialog-form").dialog("open");
					});
				}else{
					$("#dialog-form").dialog("open");
					$("#phone1").val(mobile.toString().substring(0,3)+"****"+mobile.toString().substring(7));
					$("#phone").val(mobile);
					$("#phone1").attr("readOnly",true);
					$("#userchk").focus();
					refreshCode(path);
				}
			}else{
				jAlert(data.message,"提示");
			}
		}
	}
	
  $(function() {
    var phone = $( "#phone" ),
    	userchk = $( "#userchk" ),
    	smscode = $( "#smscode" ),
      	allFields = $( [] ).add( phone ).add( userchk ).add( smscode ),
      	tips = $( ".validateTips" );
    if($( "#phone" ).val()==""){
    	phone = $( "#phone1" );
    }
 
    function updateTips( t ) {
      tips
        .text( t )
        .addClass( "ui-state-highlight" );
      setTimeout(function() {
        tips.removeClass( "ui-state-highlight", 1500 );
      }, 500 );
    }
 
    function checkLength( o, n, min, max ) {
      if ( o.val().length != max) {
        o.addClass( "ui-state-error" );
        updateTips( "" + n + " 的长度必须为 " + max + " 位。" );
        return false;
      } else {
        return true;
      }
    }
 
    function checkRegexp( o, regexp, n ) {
      if ( !( regexp.test( o.val() ) ) ) {
        o.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }
 
    $( "#dialog-form" ).dialog({
      height: 375,
      width: 630,
      //left: 650,
      autoOpen : false,
      draggable : false,
      resizable : false,
      modal: true,
      position: { my: "center", at: "left+960px top+420px ", of: window  } ,
      buttons: {
        "确认登录": function() {
          var bValid = true;
          allFields.removeClass( "ui-state-error" );
 
          bValid = bValid && checkLength( phone, "手机号码", 3, 11 );
          bValid = bValid && checkLength( userchk, "图片验证码", 1, 4 );
          bValid = bValid && checkLength( smscode, "手机动态码", 1, 6 );
 
          //bValid = bValid && checkRegexp( phone, /^[a-z]([0-9a-z_])+$/i, "用户名必须由 a-z、0-9、下划线组成，且必须以字母开头。" );
          //bValid = bValid && checkRegexp( userchk, /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i, "eg. ui@jquery.com" );
 
          if ( bValid ) {
            $( "#users tbody" ).append( "<tr>" +
              "<td>" + phone.val() + "</td>" +
              "<td>" + userchk.val() + "</td>" +
              "<td>" + smscode.val() + "</td>" +
            "</tr>" );
            
            loginA(path);
          }
        },
        "关闭": function() {
          $( this ).dialog( "close" );
        }
      },
      close: function() {
        allFields.val( "" ).removeClass( "ui-state-error" );
        var data = common_ajax.ajaxFunc("/admin/login/logout2", null, "json", null);
        if(data.success){
      	  location.href = path + "/admin/login/login";
        }
      }
    });
  });
  </script>
</html>